<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PNGCLICK WITH FIRESTORE</title>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
      import {
        getFirestore,
        onSnapshot,
        doc,
        addDoc,
        increment,
        updateDoc,
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js"; // Add Firestore imports

      const firebaseConfig = {
        apiKey: process.env.FIREBASE_API_KEY || "your-api-key-here",
        authDomain: process.env.FIREBASE_AUTH_DOMAIN || "your-auth-domain-here",
        projectId: process.env.FIREBASE_PROJECT_ID || "your-project-id-here",
        storageBucket: process.env.FIREBASE_STORAGE_BUCKET || "your-storage-bucket-here",
        messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID || "your-messaging-sender-id-here",
        appId: process.env.FIREBASE_APP_ID || "your-app-id-here",
        measurementId: process.env.FIREBASE_MEASUREMENT_ID || "your-measurement-id-here",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getFirestore(app);
      const popcatDoc = doc(database, "popcat", "info");

      // Create: Save new object to database
      const addData = async () => {
        try {
          await updateDoc(popcatDoc, {
            count: increment(1),
          });
          console.log("Data added successfully");
        } catch (error) {
          console.error("Error adding document: ", error);
          alert("fail");
        }
      };

      const setupSnapshotListener = () => {
        onSnapshot(popcatDoc, (docSnapshot) => {
          if (docSnapshot.exists()) {
            const data = docSnapshot.data();
            document.querySelector("h2").innerHTML = `Count: ${data.count}`;
          } else {
            console.log("Document does not exist");
          }
        });
      };

      window.addEventListener("DOMContentLoaded", () => {
        const saveButton = document.getElementById("saveButton");
        saveButton.addEventListener("click", addData);
        setupSnapshotListener();
      });
    </script>
  </head>
  <body>
    <h1>PNGCLICK</h1>
    <button id="saveButton">Click</button>
    <h2>Count:</h2>
  </body>
</html>
